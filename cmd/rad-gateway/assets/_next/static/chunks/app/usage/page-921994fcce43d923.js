(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[956],{5751:function(e,t,s){Promise.resolve().then(s.bind(s,9748))},9748:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=s(7437),r=s(2265),l=s(2735),n=s(4892),i=s(6311),d=s(3141),o=s(6269),c=s(4581);let x=[{value:"24h",label:"Last 24 hours",hours:24},{value:"7d",label:"Last 7 days",hours:168},{value:"30d",label:"Last 30 days",hours:720}];function m(){var e,t,s,m,u;let[v,h]=(0,r.useState)("24h"),[p,j]=(0,r.useState)(void 0),g=(0,r.useMemo)(()=>(function(e){let t=x.find(t=>t.value===e)||x[0],s=new Date;return{startTime:new Date(s.getTime()-36e5*t.hours).toISOString(),endTime:s.toISOString()}})(v),[v]),{data:N,isLoading:k,error:f}=(0,c.LD)(g),{data:b,isLoading:y,error:w}=(0,c.HN)({...g,page:1,pageSize:25}),S=(0,c.IQ)("providerId",g),T=(0,c.n)({onSuccess:e=>j(e.exportId)}),C=(0,c.Fn)(p),L=(0,r.useMemo)(()=>{let e=Object.entries(S.data).map(e=>{let[t,s]=e;return{providerName:t,requestCount:Number(s.requestCount||0),totalTokens:Number(s.totalTokens||0),costUsd:Number(s.costUsd||0)}});if(e.length>0)return e.sort((e,t)=>t.requestCount-e.requestCount);let t=new Map;return((null==b?void 0:b.data)||[]).forEach(e=>{let s=e.providerId||"unknown",a=t.get(s)||{requestCount:0,totalTokens:0,costUsd:0};a.requestCount+=1,a.totalTokens+=e.totalTokens,a.costUsd+=e.costUsd||0,t.set(s,a)}),Array.from(t.entries()).map(e=>{let[t,s]=e;return{providerName:t,...s}})},[S.data,null==b?void 0:b.data]),U=(null==b?void 0:b.data)||[],q=async e=>{await T.mutateAsync({startTime:g.startTime,endTime:g.endTime,format:e,includeCost:!0})};return(0,a.jsx)(n.L,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col justify-between gap-3 md:flex-row md:items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-[var(--ink-900)]",children:"Usage Command Deck"}),(0,a.jsx)("p",{className:"text-[var(--ink-500)]",children:"Operational usage intelligence with export-ready telemetry."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsx)("select",{value:v,onChange:e=>h(e.target.value),className:"ui-input max-w-[180px]",children:x.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsxs)(d.z,{variant:"secondary",onClick:()=>void q("csv"),loading:T.isPending,children:[(0,a.jsx)(l.Z,{className:"mr-2 h-4 w-4"}),"Export CSV"]})]})]}),(f||w)&&(0,a.jsx)(i.Z,{className:"border border-[rgba(152,43,33,0.3)] bg-[rgba(152,43,33,0.08)]",children:(0,a.jsx)("p",{className:"text-sm text-[var(--status-critical)]",children:(null===(e=f||w)||void 0===e?void 0:e.message)||"Failed to load usage telemetry."})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-5",children:[(0,a.jsxs)(i.Z,{children:[(0,a.jsx)("div",{className:"text-sm text-[var(--ink-500)]",children:"Total Requests"}),(0,a.jsx)("div",{className:"mt-1 text-2xl font-bold text-[var(--ink-900)]",children:k?"...":((null==N?void 0:N.totalRequests)||0).toLocaleString()})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)("div",{className:"text-sm text-[var(--ink-500)]",children:"Total Tokens"}),(0,a.jsx)("div",{className:"mt-1 text-2xl font-bold text-[var(--ink-900)]",children:k?"...":"".concat((((null==N?void 0:N.totalTokens)||0)/1e6).toFixed(2),"M")})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)("div",{className:"text-sm text-[var(--ink-500)]",children:"Total Cost"}),(0,a.jsx)("div",{className:"mt-1 text-2xl font-bold text-[var(--ink-900)]",children:k?"...":"$".concat(((null==N?void 0:N.totalCostUsd)||0).toFixed(2))})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)("div",{className:"text-sm text-[var(--ink-500)]",children:"Avg Latency"}),(0,a.jsx)("div",{className:"mt-1 text-2xl font-bold text-[var(--ink-900)]",children:k?"...":"".concat(Math.round((null==N?void 0:N.avgDurationMs)||0),"ms")})]}),(0,a.jsxs)(i.Z,{children:[(0,a.jsx)("div",{className:"text-sm text-[var(--ink-500)]",children:"Error Rate"}),(0,a.jsx)("div",{className:"mt-1 text-2xl font-bold text-[var(--status-critical)]",children:k?"...":"".concat(((null==N?void 0:N.errorRate)||0).toFixed(2),"%")})]})]}),(0,a.jsx)(i.Z,{title:"Usage by Provider",children:(0,a.jsxs)("div",{className:"space-y-4",children:[0===L.length&&!y&&(0,a.jsx)("p",{className:"text-sm text-[var(--ink-500)]",children:"No provider usage data available for this range."}),L.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-[var(--line-soft)] bg-[rgba(43,32,21,0.06)] px-4 py-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-[var(--ink-900)]",children:e.providerName}),(0,a.jsxs)("p",{className:"text-sm text-[var(--ink-500)]",children:[e.requestCount.toLocaleString()," requests \xb7 ",(e.totalTokens/1e6).toFixed(2),"M tokens"]})]}),(0,a.jsxs)("p",{className:"font-semibold text-[var(--ink-900)]",children:["$",e.costUsd.toFixed(2)]})]},e.providerName))]})}),(0,a.jsx)(i.Z,{title:"Recent Usage Records",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-[var(--line-strong)]",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.1em] text-[var(--ink-500)]",children:"Started"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.1em] text-[var(--ink-500)]",children:"Provider"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.1em] text-[var(--ink-500)]",children:"Model"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase tracking-[0.1em] text-[var(--ink-500)]",children:"Tokens"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold uppercase tracking-[0.1em] text-[var(--ink-500)]",children:"Cost"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold uppercase tracking-[0.1em] text-[var(--ink-500)]",children:"Status"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-[var(--line-soft)]",children:[y&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-4 py-6 text-sm text-[var(--ink-500)]",children:"Loading usage records..."})}),!y&&0===U.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-4 py-6 text-sm text-[var(--ink-500)]",children:"No usage records in this range."})}),U.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-[rgba(43,32,21,0.05)]",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-[var(--ink-900)]",children:new Date(e.startedAt).toLocaleString()}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-[var(--ink-900)]",children:e.providerId||"unknown"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-[var(--ink-900)]",children:e.selectedModel||e.incomingModel}),(0,a.jsx)("td",{className:"px-4 py-3 text-right text-sm text-[var(--ink-900)]",children:e.totalTokens.toLocaleString()}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right text-sm text-[var(--ink-900)]",children:["$",(e.costUsd||0).toFixed(4)]}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)(o.C,{color:"success"===e.responseStatus?"success":"error",children:e.responseStatus})})]},e.id))]})]})})}),(T.data||C.data)&&(0,a.jsx)(i.Z,{title:"Export Status",children:(0,a.jsxs)("div",{className:"space-y-2 text-sm text-[var(--ink-700)]",children:[(0,a.jsxs)("p",{children:["Export ID: ",(0,a.jsx)("span",{className:"font-semibold text-[var(--ink-900)]",children:null===(t=C.data||T.data)||void 0===t?void 0:t.exportId})]}),(0,a.jsxs)("p",{children:["Status: ",(0,a.jsx)("span",{className:"font-semibold text-[var(--ink-900)]",children:null===(s=C.data||T.data)||void 0===s?void 0:s.status})]}),(null===(m=C.data||T.data)||void 0===m?void 0:m.downloadUrl)&&(0,a.jsx)("a",{href:null===(u=C.data||T.data)||void 0===u?void 0:u.downloadUrl,className:"text-[var(--status-info)] underline-offset-2 hover:underline",children:"Download export payload"})]})})]})})}}},function(e){e.O(0,[142,954,909,514,735,402,534,971,117,744],function(){return e(e.s=5751)}),_N_E=e.O()}]);